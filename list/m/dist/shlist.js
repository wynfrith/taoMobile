function go(e){History.pushState({currId:e,list:list,scroll:document.body.scrollTop,resultCount:resultCount,currPage:currPage,queryObj:queryObj},"state","?state="+e)}var queryObj={pageSize:10,pageNumber:0},currPage=0,list=[],resultCount=0;$(function(){var e=navigator.userAgent,t=(e.match(/iphone/i)||e.match(/iPad/i),"click");FastClick.attach(document.body);var a="http://120.24.218.56",r="网络错误",i=$(".loading"),s="",l=function(e){list=e.data.list||[],resultCount=e.data.resultCount||0,currPage=e.data.currPage||0,queryObj=e.data.queryObj||{},document.body.scrollTop=e.data.scroll||0},n={$loading:$(".loading"),bind:function(){$("#drops").on(t,$(".drop-ul li"),this.choose),$(document).on(t,this.toggle),$(".prev-page").on(t,this.prevPage.bind(this)),$(".next-page").on(t,this.nextPage.bind(this))},choose:function(e){var i=$("#lists"),e=e||t||window.event,l=e.target||e.srcElement,o=$(l),c=n,d=$(".nav-bar a"),u=$(l).parent().attr("id").split("-")[1],p=$($(".nav-bar a[data-type="+u+"]")[0]);d.each(function(e,t){if($(t)[0]==p[0]){var d=$("#drop-"+$(t).data("type"));d.find("li").removeClass("active"),o.addClass("active");var u=$(l).data("title")||$(l).text();if($(t).html(u+' <i class="iconfont">&#xe606;</i>'),"price"==$(t).data("type"))"全部"==o.text()?(delete queryObj.rangeQuery,delete queryObj.minPrice,delete queryObj.maxPrice,$(t).css("color","#898989")):($(t).css("color","#f96a39"),queryObj.rangeQuery=1,queryObj.minPrice=$(l).data("min"),$(l).data("max")&&(queryObj.maxPrice=$(l).data("max")));else if("全部"==o.text())$(t).css("color","#898989"),delete queryObj[o.parent().data("filter")];else{$(t).css("color","#f96a39");var h=$(l).data("id")||u;queryObj[o.parent().data("filter")]=h}queryObj.pageNumber=0,s=a+"/api/sh/filter?"+urlEncode(queryObj),c.$loading.show(),$.get(s,function(e){if(0==e.code){resultCount=e.data.resultCount,list=e.data.list,currPage=0;var t=template.compile(source),a=t({shs:e.data.list});i.html(a),n.checkPage(),c.$loading.hide()}else alert(r)})}})},hasMore:function(){var e=$("#lists > a").length;return resultCount>(queryObj.pageNumber||0)*queryObj.pageSize+e},prevPage:function(){queryObj.pageNumber=(queryObj.pageNumber?parseInt(queryObj.pageNumber):0)-1;var e="/m/shs/list.html?"+urlEncode(queryObj);window.location.href=e},nextPage:function(){$list=$("#lists"),queryObj.pageNumber=(queryObj.pageNumber?parseInt(queryObj.pageNumber):0)+1;var e="/m/shs/list.html?"+urlEncode(queryObj);window.location.href=e},checkPage:function(){var e,t;n.hasMore()?($(".next-page").removeAttr("disabled"),e=!0):($(".next-page").attr("disabled","disabled"),e=!1),queryObj.pageNumber>0?($(".prev-page").removeAttr("disabled"),t=!0):($(".prev-page").attr("disabled","disabled"),t=!1),e||t?($(".page-number").text("第"+(parseInt(queryObj.pageNumber||0)+1)+"页"),$(".pagination").show()):$(".pagination").hide()},toggle:function(e){var t=e||window.event,a=t.target||t.srcElement;if($(".nav-bar").find(a).length>0){var r=$("#drop-"+($(a).data("type")||$(a).parent().data("type")));r.hasClass("active")?$(".drop-ul").removeClass("active"):($(".drop-ul").removeClass("active"),r.addClass("active"))}else $(".drop-ul").removeClass("active")},getCate:function(){$.get(a+"/api/sh/cate/list",function(e){var t=$("#drop-cate");e.data.list.forEach(function(e,a){var r=$('<li data-id="'+e.id+'" data-title="'+e.name+'">'+e.name+"</li>");t.append(r)});for(var a in queryObj){var r=queryObj[a];if("minPrice"==a)var i=$(".drop-ul[data-filter=price]");else var i=$(".drop-ul[data-filter="+a+"]");if(i.length>0){var s=$(".menu[data-type="+i.attr("id").split("-")[1]+"]");i.find("li").each(function(e,t){$(t).data("id")==r||$(t).text()==r||$(t).data("min")==r?($(t).addClass("active"),s.html($(t).text()+' <i class="iconfont">&#xe606;</i>'),s.css("color","#f96a39")):$(t).removeClass("active")})}}})}};!function(){n.getCate(),n.bind();var e=History.getState();if(e.data.currId){var t=template.compile(source),o=t({shs:e.data.list});return $("#lists").html(o),l(e),void n.checkPage()}var c=window.location.search;s=a+"/api/sh/filter?",c&&urlToObj(c,queryObj),i.show(),$.get(s+urlEncode(queryObj),function(e){if(null==e.data)alert(r);else{var t=template.compile(source),a=t({shs:e.data.list});$("#lists").html(a),list=e.data.list,resultCount=e.data.resultCount,currPage=0,n.checkPage()}i.hide()})}()});var source=["{{each shs as sh}}",'<a class="list" href="/m/shs/detail.html?id={{sh.id}}" onclick="go({{sh.id}})">','        <img src="http://120.24.218.56/static/images/users/{{sh.picturePath.split(";")[0]}}" alt="{{sh.title}}">','        <div class="content">','          <h2>{{sh.title | omit:"9"}}</h2>','          <p class="content-middle">',"            <span>{{sh.category.name}}</span>",'            <span class="oldNew">{{sh.depreciationRate}}</span>','            <span class="right price">￥<b>{{sh.sellPrice}}</b></span>',"          </p>",'          <p class="content-bottom">','            <span><i class="iconfont">&#xe600;</i>{{sh.tradePlace | omit:"6"}}</span>','            <span class="right"> <i class="iconfont">&#xe604;</i>{{sh.postTime | dateFormat:"MM-dd"}}</span>',"          </p>","        </div>","      </a>","{{/each}}"].join("");