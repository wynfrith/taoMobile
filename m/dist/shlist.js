$(function(){var a=navigator.userAgent,t=(a.match(/iphone/i)||a.match(/iPad/i),"click");FastClick.attach(document.body);var e="http://120.24.218.56",s="网络错误",i=$(".loading"),o=0,l="",n=0;i.show();var r={$loading:$(".loading"),bind:function(){$(".load-more").on(t,this.loadMore),$("#drops").on(t,$(".drop-ul li"),this.choose),$(document).on(t,this.toggle)},choose:function(a){var i=$("#lists"),c=$("#drops li"),a=a||t||window.event,d=a.target||a.srcElement,h=$(d),p=r,m=$(".nav-bar a"),v=$(d).parent().attr("id").split("-")[1],f=$($(".nav-bar a[data-type="+v+"]")[0]),u=$("#drops li[data-all=true]");m.each(function(a,t){if($(t)[0]==f[0]){var r=$(d).data("title")||$(d).text();$(t).html(r+' <i class="iconfont">&#xe606;</i>');var m=$(d).data("id")||r;if(console.log(t),"全部"==h.text())l=e+"/api/sh/filter",$(t).css("color","#898989");else if("price"==$(t).data("type")){$(t).css("color","#f96a39");var g="&minPrice="+$(d).data("min"),C=$(d).data("max")?"&maxPrice="+$(d).data("max"):"";l=e+"/api/sh/filter?rangeQuery=1"+g+C}else $(t).css("color","#f96a39"),l=e+"/api/sh/filter?"+h.parent().data("filter")+"="+m;p.$loading.show(),$.get(l,function(a){if(0==a.code){o=a.data.resultCount,n=0;var t=template.compile(source),e=t({shs:a.data.list});i.html(e),p.hasMore()?$(".load-more").addClass("active"):$(".load-more").removeClass("active"),p.$loading.hide()}else alert(s)}),c.removeClass("active"),u.each(function(a,t){$(t).parent()[0]!=$("#drop-"+v)[0]&&$(t).addClass("active")}),h.addClass("active")}else $(t).html($(t).data("default")+' <i class="iconfont">&#xe606;</i>'),$(t).css("color","#898989")})},hasMore:function(){var a=$("#lists > a").length;return o>a},loadMore:function(){var a=r;if(console.log(a),a.$moreBtn=$(".load-more"),a.hasMore()){var t="?pageNumber=";l.indexOf("?")>0&&(t="&pageNumber=");var e=l+t+(n+1);console.log(e),$lists=$("#lists"),a.$loading.show(),$.get(e,function(t){if(0==t.code){var e=template.compile(source),i=e({shs:t.data.list});$lists.append(i),n+=1,a.hasMore()||a.$moreBtn.removeClass("active")}else alert(s);a.$loading.hide()})}},toggle:function(a){var t=a||window.event,e=t.target||t.srcElement;if($(".nav-bar").find(e).length>0){var s=$("#drop-"+($(e).data("type")||$(e).parent().data("type")));s.hasClass("active")?$(".drop-ul").removeClass("active"):($(".drop-ul").removeClass("active"),s.addClass("active"))}else $(".drop-ul").removeClass("active")},getCate:function(){$.get(e+"/api/sh/cate/list",function(a){var t=$("#drop-cate");a.data.list.forEach(function(a,e){var s=$('<li data-id="'+a.id+'" data-title="'+a.name+'">'+a.name+"</li>");t.append(s)});var e=window.location.search;if(e){var s=e.split("=")[0].substr(1);console.log(s);var i=e.split("=")[1],o=$(".drop-ul[data-filter="+s+"]");o.find("li").each(function(a,t){if($(t).data("id")==i||$(t).data("title")==i){var e=o.attr("id").split("-")[1],s=$(".menu[data-type="+e+"]");console.log(s),s.html($(t).html()+' <i class="iconfont">&#xe606;</i>'),s.css("color","#f96a39"),$(t).addClass("active")}else $(t).removeClass("active")})}})}};!function(){var a=window.location.search;l=e+"/api/sh/filter",a&&(l+=a),$.get(l,function(a){if(null==a.data)alert(s);else{var t=template.compile(source),e=t({shs:a.data.list});$("#lists").html(e),o=a.data.resultCount}i.hide(),r.hasMore()?$(".load-more").addClass("active"):$(".load-more").removeClass("active")}),r.getCate(),r.bind()}()});var source=["{{each shs as sh}}",'<a class="list" href="/m/shs/detail.html?id={{sh.id}}">','        <img src="http://120.24.218.56/static/images/users/{{sh.picturePath.split(";")[0]}}" alt="{{sh.title}}">','        <div class="content">','          <h2>{{sh.title | omit:"9"}}</h2>','          <p class="content-middle">',"            <span>{{sh.category.name}}</span>",'            <span class="oldNew">{{sh.depreciationRate}}</span>','            <span class="right price">￥<b>{{sh.sellPrice}}</b></span>',"          </p>",'          <p class="content-bottom">','            <span><i class="iconfont">&#xe600;</i>{{sh.tradePlace | omit:"6"}}</span>','            <span class="right"> <i class="iconfont">&#xe604;</i>{{sh.postTime | dateFormat:"MM-dd"}}</span>',"          </p>","        </div>","      </a>","{{/each}}"].join("");